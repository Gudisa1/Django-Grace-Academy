# **Django Login System: Simple Beginner's Guide**

## **Part 1: Build Login System**

### **Step 1: Create Login View**
```python
# accounts/views.py
from django.shortcuts import render, redirect
from django.contrib.auth import authenticate, login
from django.contrib import messages

def login_view(request):
    # If user is already logged in, redirect them
    if request.user.is_authenticated:
        return redirect('dashboard')
    
    if request.method == 'POST':
        # Get form data
        username = request.POST.get('username')
        password = request.POST.get('password')
        
        # Authenticate user
        user = authenticate(request, username=username, password=password)
        
        if user is not None:
            # Login successful
            login(request, user)
            
            # Redirect to next page or dashboard
            next_page = request.GET.get('next', 'dashboard')
            return redirect(next_page)
        else:
            # Login failed
            messages.error(request, 'Invalid username or password')
    
    return render(request, 'accounts/login.html')
```

### **Step 2: Simple Login Template**
```html
<!-- templates/accounts/login.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-5">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">Login</h4>
                    </div>
                    <div class="card-body">
                        
                        {% if messages %}
                        <div class="mb-3">
                            {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">
                                {{ message }}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        <form method="post">
                            {% csrf_token %}
                            
                            <div class="mb-3">
                                <label class="form-label">Username</label>
                                <input type="text" name="username" class="form-control" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Password</label>
                                <input type="password" name="password" class="form-control" required>
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" name="remember" class="form-check-input" id="remember">
                                <label class="form-check-label" for="remember">
                                    Remember me
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                Login
                            </button>
                        </form>
                        
                        <div class="text-center mt-3">
                            <p class="mb-1">
                                <a href="#">Forgot Password?</a>
                            </p>
                            <p>
                                Don't have an account? 
                                <a href="{% url 'signup' %}">Sign up</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
```

### **Step 3: URL Configuration**
```python
# accounts/urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('login/', views.login_view, name='login'),
]

# project/urls.py
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('accounts/', include('accounts.urls')),
]
```

---

## **Part 2: Protect Pages with Login Required**

### **Step 4: Using @login_required Decorator**
```python
# accounts/views.py
from django.contrib.auth.decorators import login_required
from django.shortcuts import render

# Method 1: Decorator (Simplest)
@login_required
def dashboard_view(request):
    return render(request, 'accounts/dashboard.html')

# Method 2: Manual check
def profile_view(request):
    if not request.user.is_authenticated:
        return redirect('login')
    
    return render(request, 'accounts/profile.html')

# Method 3: Redirect with next parameter
@login_required(login_url='/accounts/login/')
def settings_view(request):
    return render(request, 'accounts/settings.html')
```

### **Step 5: Dashboard Template**
```html
<!-- templates/accounts/dashboard.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">MyApp</a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    Welcome, {{ user.username }}
                </span>
                <a class="nav-link" href="{% url 'logout' %}">Logout</a>
            </div>
        </div>
    </nav>
    
    <div class="container mt-4">
        <h1>Dashboard</h1>
        
        <!-- User Info -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>Your Information</h5>
            </div>
            <div class="card-body">
                <p><strong>Username:</strong> {{ user.username }}</p>
                <p><strong>Email:</strong> {{ user.email }}</p>
                <p><strong>Joined:</strong> {{ user.date_joined|date:"F d, Y" }}</p>
                
                <!-- Check user roles -->
                {% if user.is_staff %}
                <span class="badge bg-warning">Staff Member</span>
                {% endif %}
                
                {% if user.is_superuser %}
                <span class="badge bg-danger">Superuser</span>
                {% endif %}
            </div>
        </div>
        
        <!-- Protected Content -->
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5>Your Profile</h5>
                        <a href="{% url 'profile' %}" class="btn btn-primary">
                            View Profile
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5>Settings</h5>
                        <a href="{% url 'settings' %}" class="btn btn-secondary">
                            Edit Settings
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Only show for staff -->
            {% if user.is_staff %}
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5>Admin Area</h5>
                        <a href="/admin/" class="btn btn-danger">
                            Go to Admin
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</body>
</html>
```

### **Step 6: Settings for Login Redirect**
```python
# settings.py
LOGIN_URL = '/accounts/login/'  # Where to redirect for login
LOGIN_REDIRECT_URL = '/dashboard/'  # Where to go after login
LOGOUT_REDIRECT_URL = '/'  # Where to go after logout
```

---

## **Part 3: Logout System & User Roles**

### **Step 7: Create Logout View**
```python
# accounts/views.py
from django.contrib.auth import logout

def logout_view(request):
    logout(request)
    return redirect('home')  # Redirect to home page
```

### **Step 8: Add Logout URL**
```python
# accounts/urls.py
urlpatterns = [
    path('login/', views.login_view, name='login'),
    path('logout/', views.logout_view, name='logout'),
    path('dashboard/', views.dashboard_view, name='dashboard'),
    path('profile/', views.profile_view, name='profile'),
]
```

### **Step 9: Understanding User Roles**

**Three Types of Users:**
```python
# 1. Normal User (is_staff = False, is_superuser = False)
# - Can login to your site
# - Cannot access /admin/

# 2. Staff User (is_staff = True)
# - Can access /admin/
# - Has limited admin permissions

# 3. Superuser (is_superuser = True)
# - Can do everything
# - Full admin access
```

**Check User Roles in Views:**
```python
def some_view(request):
    user = request.user
    
    if user.is_authenticated:
        print(f"Username: {user.username}")
        print(f"Is staff: {user.is_staff}")
        print(f"Is superuser: {user.is_superuser}")
        print(f"Is active: {user.is_active}")
    
    return render(request, 'template.html')
```

### **Step 10: Role-Based Access Control**
```python
# Only allow staff members
from django.contrib.auth.decorators import user_passes_test

def staff_check(user):
    return user.is_staff

@user_passes_test(staff_check)
def staff_dashboard(request):
    return render(request, 'staff/dashboard.html')

# Only allow superusers
def superuser_check(user):
    return user.is_superuser

@user_passes_test(superuser_check)
def admin_settings(request):
    return render(request, 'admin/settings.html')
```

### **Step 11: Create Role-Based Templates**
```html
<!-- Check roles in templates -->
{% if user.is_authenticated %}
    
    <!-- Show for all logged in users -->
    <p>Welcome, {{ user.username }}!</p>
    
    <!-- Show only for staff -->
    {% if user.is_staff %}
    <div class="alert alert-warning">
        <h5>Staff Dashboard</h5>
        <a href="/admin/" class="btn btn-sm btn-warning">
            Go to Admin Panel
        </a>
    </div>
    {% endif %}
    
    <!-- Show only for superusers -->
    {% if user.is_superuser %}
    <div class="alert alert-danger">
        <h5>Superuser Controls</h5>
        <a href="{% url 'admin_settings' %}" class="btn btn-sm btn-danger">
            Advanced Settings
        </a>
    </div>
    {% endif %}
    
{% endif %}
```

### **Step 12: Complete Navigation Bar**
```html
<!-- templates/base.html -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand" href="/">MyApp</a>
        
        <div class="navbar-nav ms-auto">
            {% if user.is_authenticated %}
                <!-- Logged in user menu -->
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        {{ user.username }}
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="{% url 'dashboard' %}">
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'profile' %}">
                                Profile
                            </a>
                        </li>
                        
                        <!-- Admin link for staff -->
                        {% if user.is_staff %}
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-warning" href="/admin/">
                                Admin Panel
                            </a>
                        </li>
                        {% endif %}
                        
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="{% url 'logout' %}">
                                Logout
                            </a>
                        </li>
                    </ul>
                </div>
            {% else %}
                <!-- Guest menu -->
                <a class="nav-link" href="{% url 'login' %}">Login</a>
                <a class="nav-link" href="{% url 'signup' %}">Sign Up</a>
            {% endif %}
        </div>
    </div>
</nav>
```

---

## **Quick Reference**

### **Key Functions:**
```python
# 1. Authenticate user
user = authenticate(username='john', password='pass123')

# 2. Login user
login(request, user)

# 3. Logout user
logout(request)

# 4. Check if logged in
request.user.is_authenticated

# 5. Protect view
@login_required
def my_view(request):
    pass
```

### **User Properties:**
```python
user.username      # Username
user.email         # Email
user.is_active     # Can login (True/False)
user.is_staff      # Can access admin (True/False)
user.is_superuser  # Full permissions (True/False)
user.date_joined   # When created
user.last_login    # Last login time
```

### **Common Patterns:**
```python
# Login required pattern
@login_required
def view(request):
    # Only logged in users can access
    pass

# Role checking pattern
def view(request):
    if not request.user.is_staff:
        return redirect('home')
    # Only staff can access
    pass

# Get user info
def view(request):
    if request.user.is_authenticated:
        username = request.user.username
        email = request.user.email
```

---

## **Practice Exercise**

Create a simple note-taking app:
1. Anyone can sign up
2. Only logged-in users can create notes
3. Users can only see/edit their own notes
4. Staff users can see all notes
5. Add a logout button

**Hints:**
```python
# In views.py
@login_required
def my_notes(request):
    notes = Note.objects.filter(author=request.user)
    return render(request, 'notes/list.html', {'notes': notes})
```

---

That's all you need to get started! Remember:
1. **Login** = Verify who you are
2. **@login_required** = Protect pages
3. **Logout** = End session
4. **is_staff** = Admin access
5. **is_superuser** = Full access

