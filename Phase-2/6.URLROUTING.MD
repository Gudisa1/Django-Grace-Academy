# **Django URL Routing: Complete Guide with Dynamic Parameters**

## **Objective**
Master Django's URL routing system including path definitions, app-level routing, dynamic parameters, and URL reversing for maintainable web applications.

---

## **Prerequisites**
- Basic Django project setup
- Understanding of views
- Python 3.x installed

---

## **Part 1: URL Routing Fundamentals**

### **Step 1: Understanding Django URL Dispatcher**

**How Django processes a URL request:**
```
Browser Request → Django URL Dispatcher → Matched View → Response
```

**Key components:**
1. **`urls.py`** - URL configuration file
2. **`path()`** - Function to define routes
3. **`include()`** - For including other URL configurations
4. **URL patterns** - List of route definitions

### **Step 2: Project-Level URL Configuration**

**Default project structure:**
```
myproject/
├── myproject/
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py      ← Main URL configuration
│   └── wsgi.py
└── manage.py
```

**Initial `myproject/urls.py`:**
```python
from django.contrib import admin
from django.urls import path

urlpatterns = [
    path('admin/', admin.site.urls),
]
```

### **Step 3: Basic Path Routing**

**Syntax:**
```python
path(route, view, kwargs=None, name=None)
```

**Example: Adding a home page route**
```python
# myproject/urls.py
from django.contrib import admin
from django.urls import path
from django.http import HttpResponse

# Simple view function
def home_view(request):
    return HttpResponse("Welcome to the Home Page!")

def about_view(request):
    return HttpResponse("About Us Page")

def contact_view(request):
    return HttpResponse("Contact Page")

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', home_view, name='home'),           # Root URL
    path('about/', about_view, name='about'),   # /about/
    path('contact/', contact_view, name='contact'),  # /contact/
]
```

### **Step 4: Creating App-Level URL Configuration**

**Best Practice:** Each app should have its own `urls.py`

1. **Create app URLs file:**
```bash
# In your app directory
touch myapp/urls.py
```

2. **Configure app `urls.py`:**
```python
# myapp/urls.py
from django.urls import path
from . import views  # Import views from current directory

app_name = 'myapp'  # Namespace for reverse URL lookups

urlpatterns = [
    path('', views.book_list, name='book_list'),
    path('books/', views.book_list, name='book_list'),
    path('books/create/', views.book_create, name='book_create'),
    path('books/<int:id>/', views.book_detail, name='book_detail'),
]
```

3. **Include in project URLs:**
```python
# myproject/urls.py
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('myapp.urls')),  # Include app URLs at root
    # OR with a prefix:
    # path('app/', include('myapp.urls')),  # Access at /app/books/
]
```

### **Step 5: Multiple App URL Configuration**

**Project with multiple apps:**
```python
# myproject/urls.py
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    
    # App with namespace
    path('books/', include('books.urls', namespace='books')),
    
    # Blog app
    path('blog/', include('blog.urls')),
    
    # User accounts
    path('accounts/', include('accounts.urls')),
    
    # API endpoints
    path('api/v1/', include('api.urls')),
    
    # Third-party apps
    path('api-auth/', include('rest_framework.urls')),
]
```

---

## **Part 2: Dynamic URLs & Path Converters**

### **Step 6: Understanding Path Converters**

Django provides built-in path converters:
- **`str`** - Matches any non-empty string (default)
- **`int`** - Matches zero or positive integers
- **`slug`** - Matches ASCII letters, numbers, hyphens, underscores
- **`uuid`** - Matches UUID strings
- **`path`** - Matches any string including `/`

### **Step 7: Basic Dynamic URL Patterns**

**Single parameter:**
```python
# myapp/urls.py
from django.urls import path
from . import views

urlpatterns = [
    # String parameter
    path('books/<str:title>/', views.book_by_title, name='book_by_title'),
    
    # Integer parameter (common for IDs)
    path('books/<int:id>/', views.book_detail, name='book_detail'),
    
    # Slug parameter (URL-friendly)
    path('posts/<slug:slug>/', views.post_detail, name='post_detail'),
    
    # UUID parameter
    path('documents/<uuid:doc_id>/', views.document_view, name='document'),
]
```

**Corresponding views:**
```python
# myapp/views.py
from django.shortcuts import render, get_object_or_404
from django.http import HttpResponse
from .models import Book, Post, Document

def book_detail(request, id):
    book = get_object_or_404(Book, id=id)
    return render(request, 'books/detail.html', {'book': book})

def book_by_title(request, title):
    book = get_object_or_404(Book, title=title)
    return HttpResponse(f"Book: {book.title}")

def post_detail(request, slug):
    post = get_object_or_404(Post, slug=slug)
    return render(request, 'posts/detail.html', {'post': post})

def document_view(request, doc_id):
    document = get_object_or_404(Document, id=doc_id)
    return HttpResponse(f"Document ID: {doc_id}")
```

### **Step 8: Multiple Parameters in URLs**

**Combining multiple parameters:**
```python
# myapp/urls.py
urlpatterns = [
    # Category and slug
    path('blog/<str:category>/<slug:slug>/', 
         views.blog_post, name='blog_post'),
    
    # Year, month, and slug for blog posts
    path('blog/<int:year>/<int:month>/<slug:slug>/',
         views.post_detail, name='post_detail'),
    
    # User and post ID
    path('users/<int:user_id>/posts/<int:post_id>/',
         views.user_post, name='user_post'),
]
```

**View with multiple parameters:**
```python
# myapp/views.py
def blog_post(request, category, slug):
    post = get_object_or_404(Post, category__name=category, slug=slug)
    return render(request, 'blog/post.html', {'post': post})

def post_detail(request, year, month, slug):
    post = get_object_or_404(
        Post, 
        published_date__year=year,
        published_date__month=month,
        slug=slug
    )
    return render(request, 'blog/detail.html', {'post': post})
```

### **Step 9: Optional Parameters & Default Values**

**Using re_path (regex) for complex patterns:**
```python
from django.urls import path, re_path
from . import views

urlpatterns = [
    # Optional page parameter
    path('articles/', views.articles_list, name='articles_list'),
    path('articles/page/<int:page>/', views.articles_list, name='articles_list_paged'),
    
    # Or using single pattern with optional parameter
    re_path(r'^articles/(?:page/(?P<page>\d+)/)?$', 
            views.articles_list, 
            name='articles_list'),
]
```

**View with optional parameter:**
```python
def articles_list(request, page=1):
    # page defaults to 1 if not provided
    articles = Article.objects.all()
    # Pagination logic here
    return render(request, 'articles/list.html', {'articles': articles})
```

### **Step 10: Custom Path Converters**

**Create your own converter:**
```python
# myapp/converters.py
class FourDigitYearConverter:
    regex = '[0-9]{4}'  # Regex pattern
    
    def to_python(self, value):
        # Convert to Python object
        return int(value)
    
    def to_url(self, value):
        # Convert to URL string
        return f'{value:04d}'  # Ensure 4 digits

class UsernameConverter:
    regex = '[a-zA-Z][a-zA-Z0-9_]{2,19}'  # 3-20 chars, starts with letter
    
    def to_python(self, value):
        return value.lower()  # Convert to lowercase
    
    def to_url(self, value):
        return value
```

**Register and use custom converters:**
```python
# myapp/urls.py
from django.urls import path, register_converter
from . import converters, views

# Register custom converters
register_converter(converters.FourDigitYearConverter, 'yyyy')
register_converter(converters.UsernameConverter, 'username')

urlpatterns = [
    path('archive/<yyyy:year>/', views.year_archive, name='year_archive'),
    path('profile/<username:username>/', views.user_profile, name='user_profile'),
]
```

---

## **Part 3: URL Reverse Lookup & Best Practices**

### **Step 11: Understanding URL Reverse Lookup**

**Why use reverse URL lookup?**
1. **Decoupling**: Change URLs without changing templates/views
2. **Maintainability**: Centralized URL configuration
3. **Readability**: Named URLs are self-documenting

### **Step 12: Basic Reverse Lookup**

**In templates:**
```html
<!-- Instead of hardcoding -->
<a href="/books/42/">View Book</a>

<!-- Use url tag with named URL -->
<a href="{% url 'book_detail' id=42 %}">View Book</a>

<!-- With multiple parameters -->
<a href="{% url 'blog_post' category='python' slug='django-tutorial' %}">
    Django Tutorial
</a>
```

**In views:**
```python
# myapp/views.py
from django.shortcuts import render, redirect
from django.urls import reverse
from django.http import HttpResponseRedirect

def create_book(request):
    if request.method == 'POST':
        # Save book
        book = Book.objects.create(...)
        # Redirect using reverse
        return redirect('book_detail', id=book.id)
        # OR
        # return HttpResponseRedirect(reverse('book_detail', args=[book.id]))
    
    return render(request, 'books/create.html')
```

### **Step 13: Reverse with Namespace**

**When using app namespaces:**
```python
# books/urls.py
app_name = 'books'  # App namespace

urlpatterns = [
    path('', views.book_list, name='list'),
    path('<int:id>/', views.book_detail, name='detail'),
]

# blog/urls.py
app_name = 'blog'

urlpatterns = [
    path('', views.post_list, name='list'),
    path('<slug:slug>/', views.post_detail, name='detail'),
]
```

**Using namespaced URLs:**
```html
<!-- In templates -->
<a href="{% url 'books:detail' id=42 %}">Book Detail</a>
<a href="{% url 'blog:detail' slug='my-post' %}">Blog Post</a>

<!-- In Python code -->
reverse('books:detail', args=[42])
reverse('blog:detail', kwargs={'slug': 'my-post'})
```

### **Step 14: Reverse with Query Parameters**

**Adding query parameters to reversed URLs:**
```python
from django.urls import reverse
from urllib.parse import urlencode

def some_view(request):
    # Base URL
    base_url = reverse('search_results')
    
    # Add query parameters
    query_params = urlencode({'q': 'django', 'page': 2})
    
    # Full URL
    full_url = f"{base_url}?{query_params}"
    
    # Or using dictionary
    params = {'q': 'django', 'sort': 'date'}
    url_with_params = reverse('search_results') + '?' + urlencode(params)
    
    return redirect(full_url)
```

**In templates with custom tag (advanced):**
```python
# myapp/templatetags/url_helpers.py
from django import template
from urllib.parse import urlencode

register = template.Library()

@register.simple_tag
def url_add_params(url, **kwargs):
    """Add query parameters to URL"""
    params = urlencode(kwargs)
    return f"{url}?{params}" if params else url
```

```html
<!-- Usage in template -->
{% load url_helpers %}

<a href="{% url 'search' %}{% url_add_params q='django' page=2 sort='newest' %}">
    Search Django
</a>
```

### **Step 15: Get Absolute URL for Models**

**Add get_absolute_url to models:**
```python
# myapp/models.py
from django.db import models
from django.urls import reverse

class Book(models.Model):
    title = models.CharField(max_length=200)
    slug = models.SlugField(unique=True)
    
    def get_absolute_url(self):
        return reverse('book_detail', kwargs={'slug': self.slug})

class Author(models.Model):
    name = models.CharField(max_length=100)
    
    def get_absolute_url(self):
        return reverse('author_detail', args=[self.id])
```

**Usage:**
```html
<!-- In templates -->
<a href="{{ book.get_absolute_url }}">{{ book.title }}</a>
<a href="{{ author.get_absolute_url }}">{{ author.name }}</a>

<!-- In admin for "View on site" button -->
# In admin.py
from django.contrib import admin
from .models import Book

@admin.register(Book)
class BookAdmin(admin.ModelAdmin):
    # Enables "View on site" button in admin
    view_on_site = True
```

---

## **Part 4: Advanced URL Patterns & Best Practices**

### **Step 16: RESTful URL Design**

**Example RESTful URL patterns:**
```python
# api/urls.py
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from . import views

router = DefaultRouter()
router.register(r'books', views.BookViewSet)
router.register(r'authors', views.AuthorViewSet)

urlpatterns = [
    path('', include(router.urls)),
]

# Generated URLs:
# GET    /api/books/          - List books
# POST   /api/books/          - Create book
# GET    /api/books/{id}/     - Get book
# PUT    /api/books/{id}/     - Update book
# DELETE /api/books/{id}/     - Delete book
```

### **Step 17: URL Configuration Best Practices**

**1. Organize by app:**
```python
# Good structure
urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', include('api.urls')),
    path('store/', include('store.urls')),
    path('blog/', include('blog.urls')),
    path('', include('pages.urls')),  # Static pages last
]
```

**2. Use meaningful names:**
```python
# Good
path('books/<int:id>/reviews/', views.book_reviews, name='book_reviews')
path('users/<int:user_id>/profile/', views.user_profile, name='user_profile')

# Avoid
path('page1/', views.view1, name='view1')
path('page2/', views.view2, name='view2')
```

**3. Consistent trailing slashes:**
```python
# Django convention: include trailing slash
path('articles/', views.articles_list),  # ✓ Preferred
path('articles', views.articles_list),   # ⚠️ Avoid

# Settings adjustment (if needed):
# APPEND_SLASH = True  # Default, redirects /articles to /articles/
```

**4. Version your API URLs:**
```python
# api/urls.py
urlpatterns = [
    path('v1/', include('api.v1.urls', namespace='v1')),
    path('v2/', include('api.v2.urls', namespace='v2')),
    path('latest/', include('api.v2.urls')),  # Alias
]
```

### **Step 18: Error Handling URLs**

**Custom error pages:**
```python
# myproject/urls.py (at the end)
from django.urls import path
from . import views

# Error handlers
handler404 = 'myproject.views.custom_404'
handler500 = 'myproject.views.custom_500'
handler403 = 'myproject.views.custom_403'
handler400 = 'myproject.views.custom_400'

urlpatterns = [
    # ... your normal URLs ...
]

# myproject/views.py
def custom_404(request, exception):
    return render(request, '404.html', status=404)

def custom_500(request):
    return render(request, '500.html', status=500)
```

### **Step 19: Debugging URLs**

**List all URLs:**
```bash
# Show all URLs with names
python manage.py show_urls

# Format as table
python manage.py show_urls --format=table

# Check URL resolution
python manage.py shell
```
```python
from django.urls import resolve, reverse, Resolver404

# Check what view would handle a path
match = resolve('/books/42/')
print(match.url_name)      # 'book_detail'
print(match.app_name)      # 'books'
print(match.args)          # ()
print(match.kwargs)        # {'id': 42}

# Test reverse lookup
try:
    url = reverse('book_detail', kwargs={'id': 42})
    print(url)  # '/books/42/'
except Exception as e:
    print(f"Error: {e}")
```

---

## **Common Pitfalls & Solutions**

### **Pitfall 1: URL Pattern Order Matters**
```python
# Wrong order - specific after general
urlpatterns = [
    path('books/new/', views.new_book, name='new_book'),
    path('books/<int:id>/', views.book_detail, name='book_detail'),
    # 'books/new/' will never match because 'books/<int:id>/' catches it first
]

# Correct order - specific before general
urlpatterns = [
    path('books/new/', views.new_book, name='new_book'),      # Specific
    path('books/<int:id>/', views.book_detail, name='book_detail'),  # General
    path('books/<int:id>/edit/', views.edit_book, name='edit_book'), # More specific
]
```

### **Pitfall 2: Missing URL Names**
```python
# Bad - No name
path('books/', views.book_list)

# Good - With name
path('books/', views.book_list, name='book_list')
```

### **Pitfall 3: Incorrect Parameter Types**
```python
# View expects integer
def book_detail(request, id):
    pass

# URL pattern provides string
path('books/<str:id>/', views.book_detail)  # ❌ Mismatch

path('books/<int:id>/', views.book_detail)  # ✅ Correct
```

### **Pitfall 4: Not Using Namespaces**
```python
# Without namespace (problematic with multiple apps)
path('', include('books.urls')),  # Both apps have 'detail' URL name
path('', include('blog.urls')),

# With namespace (recommended)
path('books/', include('books.urls', namespace='books')),
path('blog/', include('blog.urls', namespace='blog')),
```

---

## **Quick Reference Cheat Sheet**

```python
# Basic URL patterns
path('', home_view, name='home')
path('about/', about_view, name='about')
path('contact/', contact_view, name='contact')

# Dynamic URLs
path('users/<int:user_id>/', user_detail, name='user_detail')
path('posts/<slug:slug>/', post_detail, name='post_detail')
path('archive/<int:year>/<int:month>/', archive_view, name='archive')

# Include other URL configurations
path('blog/', include('blog.urls'))
path('api/v1/', include('api.urls'))

# With namespace
path('store/', include('store.urls', namespace='store'))

# Reverse URL lookup
from django.urls import reverse
url = reverse('user_detail', args=[42])
url = reverse('post_detail', kwargs={'slug': 'my-post'})

# In templates
{% url 'user_detail' user.id %}
{% url 'post_detail' slug=post.slug %}
{% url 'store:product_detail' id=product.id %}

# Model get_absolute_url
class Product(models.Model):
    def get_absolute_url(self):
        return reverse('product_detail', args=[self.id])
```

---

## **Practice Exercises**

### **Exercise 1: E-commerce URL Design**
Create URL patterns for an e-commerce site:
- `/products/` - List all products
- `/products/<int:id>/` - Product detail
- `/products/<slug:category>/` - Products by category
- `/cart/` - Shopping cart
- `/checkout/` - Checkout process
- `/order/<uuid:order_id>/` - Order tracking

### **Exercise 2: Blog with Nested URLs**
Design URLs for a blog with categories and tags:
- `/blog/` - All posts
- `/blog/<slug:category>/` - Posts by category
- `/blog/tag/<slug:tag>/` - Posts by tag
- `/blog/<int:year>/<int:month>/<slug:slug>/` - Individual post
- `/blog/author/<str:username>/` - Posts by author

### **Exercise 3: API Versioning**
Create URL structure for versioned API:
- `/api/v1/users/` - v1 users endpoint
- `/api/v1/products/` - v1 products endpoint
- `/api/v2/users/` - v2 users endpoint
- `/api/latest/products/` - Alias to latest version

---
