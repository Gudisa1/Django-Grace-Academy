# **Django Authentication: Simple Beginner's Guide**

## **Part 1: Authentication vs Authorization**

### **What's the Difference?**

**Authentication** = Who you are
```python
# Examples: 
# - Login with username/password
# - "Are you John?"
```

**Authorization** = What you can do
```python
# Examples:
# - Can edit posts
# - Can delete files
# - "Can John delete this post?"
```

### **Django User Types**
```python
# 1. Anonymous User (not logged in)
request.user.is_authenticated  # False

# 2. Regular User (logged in)
request.user.is_authenticated  # True

# 3. Staff User (admin access)
request.user.is_staff  # True

# 4. Superuser (full access)
request.user.is_superuser  # True
```

---

## **Part 2: Simple Signup System**

### **Step 1: Create App**
```bash
python manage.py startapp accounts
```

### **Step 2: Add to settings.py**
```python
# settings.py
INSTALLED_APPS = [
    # ...
    'accounts',
]

# Redirect after login
LOGIN_REDIRECT_URL = '/'
LOGOUT_REDIRECT_URL = '/'
```

### **Step 3: Create Simple Form**
```python
# accounts/forms.py
from django import forms
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth.models import User

class SimpleSignupForm(UserCreationForm):
    email = forms.EmailField(required=True)
    
    class Meta:
        model = User
        fields = ['username', 'email', 'password1', 'password2']
    
    def clean_email(self):
        email = self.cleaned_data.get('email')
        if User.objects.filter(email=email).exists():
            raise forms.ValidationError("Email already exists")
        return email
```

### **Step 4: Create Simple View**
```python
# accounts/views.py
from django.shortcuts import render, redirect
from django.contrib.auth import login
from .forms import SimpleSignupForm

def signup_view(request):
    if request.method == 'POST':
        form = SimpleSignupForm(request.POST)
        if form.is_valid():
            user = form.save()
            login(request, user)  # Auto login after signup
            return redirect('home')
    else:
        form = SimpleSignupForm()
    
    return render(request, 'accounts/signup.html', {'form': form})
```

### **Step 5: Create URLs**
```python
# accounts/urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('signup/', views.signup_view, name='signup'),
]

# project urls.py
from django.contrib import admin
from django.urls import path, include
from django.contrib.auth import views as auth_views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('accounts/', include('accounts.urls')),
    # Built-in auth views
    path('accounts/login/', auth_views.LoginView.as_view(), name='login'),
    path('accounts/logout/', auth_views.LogoutView.as_view(), name='logout'),
]
```

### **Step 6: Create Simple Template**
```html
<!-- templates/accounts/signup.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Sign Up</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="text-center">Create Account</h3>
                    </div>
                    <div class="card-body">
                        <form method="post">
                            {% csrf_token %}
                            
                            <!-- Username -->
                            <div class="mb-3">
                                <label class="form-label">Username</label>
                                {{ form.username }}
                                {% if form.username.errors %}
                                <div class="text-danger small">
                                    {{ form.username.errors }}
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Email -->
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                <div class="text-danger small">
                                    {{ form.email.errors }}
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Password 1 -->
                            <div class="mb-3">
                                <label class="form-label">Password</label>
                                {{ form.password1 }}
                                <div class="form-text">
                                    Must be at least 8 characters
                                </div>
                                {% if form.password1.errors %}
                                <div class="text-danger small">
                                    {{ form.password1.errors }}
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Password 2 -->
                            <div class="mb-3">
                                <label class="form-label">Confirm Password</label>
                                {{ form.password2 }}
                                {% if form.password2.errors %}
                                <div class="text-danger small">
                                    {{ form.password2.errors }}
                                </div>
                                {% endif %}
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                Sign Up
                            </button>
                        </form>
                        
                        <div class="text-center mt-3">
                            <p>Already have an account? 
                                <a href="{% url 'login' %}">Login here</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</body>
</html>
```

### **Step 7: Login Template**
```html
<!-- templates/registration/login.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="text-center">Login</h3>
                    </div>
                    <div class="card-body">
                        <form method="post">
                            {% csrf_token %}
                            
                            <!-- Username -->
                            <div class="mb-3">
                                <label class="form-label">Username</label>
                                <input type="text" name="username" class="form-control" required>
                            </div>
                            
                            <!-- Password -->
                            <div class="mb-3">
                                <label class="form-label">Password</label>
                                <input type="password" name="password" class="form-control" required>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                Login
                            </button>
                        </form>
                        
                        <div class="text-center mt-3">
                            <p>Don't have an account? 
                                <a href="{% url 'signup' %}">Sign up here</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
```

### **Step 8: Check Login Status**
```html
<!-- In any template -->
{% if user.is_authenticated %}
    <p>Welcome, {{ user.username }}!</p>
    <a href="{% url 'logout' %}">Logout</a>
{% else %}
    <a href="{% url 'login' %}">Login</a>
    <a href="{% url 'signup' %}">Sign Up</a>
{% endif %}
```

### **Step 9: Protect Views**
```python
# views.py
from django.contrib.auth.decorators import login_required

@login_required
def secret_page(request):
    return render(request, 'secret.html')
```

---

## **Quick Cheat Sheet**

### **1. Create Superuser**
```bash
python manage.py createsuperuser
# Follow prompts for username, email, password
```

### **2. Check User in Shell**
```bash
python manage.py shell
```
```python
from django.contrib.auth.models import User

# Create user
user = User.objects.create_user('john', 'john@email.com', 'password123')

# Check password
user.check_password('password123')  # True/False

# Make staff
user.is_staff = True
user.save()
```

### **3. Basic Views**
```python
# Login
from django.contrib.auth import authenticate, login

user = authenticate(username='john', password='password123')
if user is not None:
    login(request, user)

# Logout
from django.contrib.auth import logout
logout(request)

# Check permissions
if request.user.has_perm('app.add_model'):
    # Can add items
    pass
```

### **4. In Templates**
```html
<!-- Check login -->
{% if user.is_authenticated %}
    Logged in as: {{ user.username }}
{% endif %}

<!-- Check permissions -->
{% if perms.app.add_book %}
    <button>Add Book</button>
{% endif %}
```

---

## **Common Issues & Fixes**

### **1. "TemplateDoesNotExist: registration/login.html"**
```python
# settings.py - Add template directory
TEMPLATES = [
    {
        'DIRS': [BASE_DIR / 'templates'],  # Add this
    },
]
```

### **2. User already exists**
```python
# Check before creating
if not User.objects.filter(username='john').exists():
    User.objects.create_user('john', 'password123')
```

### **3. Login not working**
- Check username/password in admin first
- Make sure user is active: `user.is_active = True`
- Check for typos in form field names

---

## **Practice Exercise**

Build a simple blog where:
1. Anyone can view posts
2. Only logged-in users can create posts
3. Only post authors can edit/delete their posts

**Hints:**
```python
# In view
if request.user == post.author:
    # Allow edit/delete
```

---
